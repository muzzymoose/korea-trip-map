<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korea Trip - Full Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f3e8ff 100%);
            padding: 16px;
            min-height: 100vh;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        .header {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .header h1 { font-size: 28px; color: #1f2937; margin-bottom: 8px; }
        .header p { color: #6b7280; font-size: 14px; }
        
        .day-selector {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 16px;
            margin-bottom: 24px;
            overflow-x: auto;
        }
        
        .day-buttons { display: flex; gap: 8px; min-width: max-content; }
        
        .day-btn {
            padding: 12px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: #f3f4f6;
            color: #374151;
            min-width: 80px;
        }
        
        .day-btn.active {
            background: #3b82f6;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }
        
        .day-label { font-size: 10px; opacity: 0.75; }
        .day-date { font-size: 14px; }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }
        
        @media (min-width: 1024px) {
            .main-content { grid-template-columns: 1fr 1fr; }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 24px;
        }
        
        .card h2 { color: #1f2937; margin-bottom: 16px; font-size: 20px; }
        .card h3 { color: #1f2937; margin-bottom: 16px; font-size: 18px; }
        
        .map-container {
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            position: relative;
            height: 500px;
            margin-bottom: 16px;
            overflow: hidden; /* Important for Google Maps */
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }
 
        .map-svg {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .location-marker {
            position: absolute;
            transform: translate(-50%, -50%);
            z-index: 10;
        }
        
        .marker-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: 2px solid white;
        }
        
        .marker-icon::before { content: 'üìç'; font-size: 16px; }
        
        .marker-label {
            position: absolute;
            top: 100%;
            margin-top: 6px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            background: rgba(255,255,255,0.95);
            padding: 4px 10px;
            border-radius: 999px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-size: 10px;
            font-weight: 700;
        }
        
        .region-label {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(255,255,255,0.95);
            padding: 8px 12px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 5;
        }
        
        .region-label-title { font-size: 9px; color: #6b7280; }
        .region-label-text { font-weight: 700; color: #1f2937; font-size: 12px; }

        .stats-row { display: flex; gap: 12px; margin-bottom: 16px; }
        .stat-card {
            flex: 1;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-icon { font-size: 20px; margin-bottom: 4px; }
        .stat-value { font-weight: 700; font-size: 18px; color: #1f2937; }
        .stat-label { font-size: 11px; color: #6b7280; margin-top: 2px; }

        .timeline { max-height: 600px; overflow-y: auto; }
        .timeline-item {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            position: relative;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 23px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background: #e5e7eb;
        }
        .timeline-item:last-child::before { display: none; }
        .timeline-time { flex-shrink: 0; width: 60px; padding-top: 4px; }
        .time-badge {
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
        }
        .timeline-marker {
            flex-shrink: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3b82f6;
            margin-top: 8px;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #3b82f6;
            z-index: 1;
        }
        .timeline-content {
            flex: 1;
            background: #f9fafb;
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
        }
        .timeline-location {
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
            font-size: 14px;
        }
        .timeline-activity { color: #4b5563; font-size: 13px; line-height: 1.5; }
        .timeline-transport {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 8px;
            padding: 4px 10px;
            background: white;
            border-radius: 6px;
            font-size: 11px;
            color: #6b7280;
            border: 1px solid #e5e7eb;
        }

        .bg-blue { background: #3b82f6; }
        .bg-purple { background: #a855f7; }
        .bg-green { background: #22c55e; }
        .bg-yellow { background: #eab308; }
        .bg-pink { background: #ec4899; }
        .bg-orange { background: #f97316; }
        
        .route-line { stroke-width: 3; opacity: 0.7; fill: none; }
        .route-car { stroke: #3b82f6; }
        .route-subway { stroke: #22c55e; }
        .route-walk { stroke: #eab308; stroke-dasharray: 5,5; }
        .route-bus { stroke: #a855f7; }

        .legend-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 16px; }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 12px; }
        .legend-color { width: 14px; height: 14px; border-radius: 50%; flex-shrink: 0; }

        .timeline-item:hover {
            transform: translateX(4px);
            transition: all 0.2s ease;
        }

        .timeline-item {
            transition: all 0.2s ease;
        }
    </style>
</head>
<body>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAMh_ugrzORkdBLgzyY-SbbJSGy3-mbafw&callback=initMap" async defer></script>
    <div class="container">
        <div class="header">
            <h1>üá∞üá∑ Korea Family Trip - Full Schedule</h1>
            <p>Dec 19-28, 2024 ‚Ä¢ 10 Days</p>
        </div>
        
        <div class="day-selector">
            <div class="day-buttons" id="dayButtons"></div>
        </div>
        
        <div class="main-content">
            <div>
                <div class="card">
                    <h2 id="dayTitle">Day 1: Departure</h2>
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-icon">üöó</div>
                            <div class="stat-value" id="statDriving">0km</div>
                            <div class="stat-label">Driving</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üöá</div>
                            <div class="stat-value" id="statSubway">0km</div>
                            <div class="stat-label">Subway</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üö∂</div>
                            <div class="stat-value" id="statWalking">0km</div>
                            <div class="stat-label">Walking</div>
                        </div>
                    </div>
                        <div class="map-container">
                            <div id="map"></div>
                            <div class="region-label">
                                <div class="region-label-title">Region</div>
                                <div class="region-label-text" id="regionText">Malaysia</div>
                            </div>
                        </div>
                    </div>
                    <div class="legend-grid">
                        <div class="legend-item"><div class="legend-color bg-blue"></div><span>Home</span></div>
                        <div class="legend-item"><div class="legend-color bg-purple"></div><span>Airport</span></div>
                        <div class="legend-item"><div class="legend-color bg-green"></div><span>Resort</span></div>
                        <div class="legend-item"><div class="legend-color bg-yellow"></div><span>Attraction</span></div>
                        <div class="legend-item"><div class="legend-color bg-pink"></div><span>Shopping</span></div>
                        <div class="legend-item"><div class="legend-color bg-orange"></div><span>Food</span></div>
                    </div>
                </div>
            </div>
            <div>
                <div class="card">
                    <h3>üìÖ Daily Schedule</h3>
                    <div class="timeline" id="timeline"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let map;
        let markers = [];
        let polylines = []; // Add this to track route lines
        let markersByLocation = {};
        let currentDay = 0;
        
        const typeColors = {
            home: "#3b82f6",      // blue
            airport: "#a855f7",   // purple
            resort: "#22c55e",    // green
            attraction: "#eab308", // yellow
            shopping: "#ec4899",  // pink
            food: "#f97316"       // orange
        };

        const scheduleData = [
            {
                day: 0, date: "Dec 19", title: "Departure",
                center: { lat: 3.1390, lng: 101.6869 }, // KLIA
                zoom: 10,
                locations: [
                    { name: "KLIA", type: "airport", coords: { lat: 2.7456, lng: 101.7098 } }
                ],
                routes: [], 
                stats: { driving: 0, subway: 0, walking: 0 },
                schedule: [
                    { time: "Evening", location: "KLIA", activity: "Depart to Incheon", transport: null }
                ]
            },
            {
                day: 1, date: "Dec 20", title: "Arrival & Ski Resort",
                center: { lat: 37.6500, lng: 128.6700 },
                zoom: 9,
                locations: [
                    { name: "Incheon", type: "airport", coords: { lat: 37.4602, lng: 126.4407 } },
                    { name: "Ski Resort", type: "resort", coords: { lat: 37.6500, lng: 128.6700 } }
                ],
                routes: [{ from: 0, to: 1, type: "car" }],
                stats: { driving: 150, subway: 0, walking: 1 },
                schedule: [
                    { time: "6:30", location: "Incheon Airport", activity: "Arrival", transport: null },
                    { time: "7:30", location: "Airport", activity: "Meet driver", transport: "üöó 2.5h" },
                    { time: "10:00", location: "Ski Resort", activity: "Arrive", transport: null },
                    { time: "11:00", location: "Hotel", activity: "Check-in", transport: "üö∂" },
                    { time: "13:00", location: "Restaurant", activity: "Lunch", transport: "üö∂" },
                    { time: "15:00", location: "Resort", activity: "Explore", transport: "üö∂" },
                    { time: "16:00", location: "Ski Rental", activity: "Equipment sizing", transport: "üö∂" },
                    { time: "18:00", location: "Restaurant", activity: "Dinner", transport: "üö∂" },
                    { time: "20:00", location: "Room", activity: "Rest", transport: null }
                ]
            },
            {
                day: 2, date: "Dec 21", title: "Full Ski Day",
                center: { lat: 37.6500, lng: 128.6700 },
                zoom: 14,
                locations: [
                    { name: "Ski Resort", type: "resort", coords: { lat: 37.6500, lng: 128.6700 } }
                ],
                routes: [], 
                stats: { driving: 0, subway: 0, walking: 2 },
                schedule: [
                    { time: "8:00", location: "Restaurant", activity: "Breakfast", transport: "üö∂" },
                    { time: "9:00", location: "Slopes", activity: "Ski lesson (2hrs)", transport: null },
                    { time: "10:30", location: "Slopes", activity: "Kids group lesson", transport: null },
                    { time: "12:00", location: "Slope Restaurant", activity: "Lunch", transport: "üö∂" },
                    { time: "13:30", location: "Slopes", activity: "Continue skiing", transport: null },
                    { time: "15:00", location: "Slopes", activity: "Family skiing", transport: "üö∂" },
                    { time: "16:30", location: "Caf√©", activity: "Hot chocolate", transport: "üö∂" },
                    { time: "18:30", location: "Restaurant", activity: "Dinner", transport: "üö∂" },
                    { time: "20:00", location: "Room", activity: "Rest", transport: null }
                ]
            },
            {
                day: 3, date: "Dec 22", title: "Resort Activities",
                center: { lat: 37.6500, lng: 128.6700 },
                zoom: 14,
                locations: [
                    { name: "Ski Resort", type: "resort", coords: { lat: 37.6500, lng: 128.6700 } }
                ],
                routes: [], 
                stats: { driving: 0, subway: 0, walking: 2 },
                schedule: [
                    { time: "8:00", location: "Restaurant", activity: "Breakfast", transport: "üö∂" },
                    { time: "9:30", location: "Gondola", activity: "Gondola ride", transport: null },
                    { time: "10:30", location: "Mountain", activity: "Winter photos", transport: "üö∂" },
                    { time: "12:00", location: "Restaurant", activity: "Lunch", transport: "üö∂" },
                    { time: "14:00", location: "Sheep Area", activity: "Sheep feeding", transport: "üö∂" },
                    { time: "15:30", location: "Trails", activity: "Scenic walk", transport: "üö∂" },
                    { time: "18:00", location: "Restaurant", activity: "Dinner", transport: "üö∂" },
                    { time: "20:00", location: "Room", activity: "Pack", transport: null }
                ]
            },
            {
                day: 4, date: "Dec 23", title: "Nami Island ‚Üí Seoul",
                center: { lat: 37.7913, lng: 127.5261 },
                zoom: 9,
                locations: [
                    { name: "Ski Resort", type: "resort", coords: { lat: 37.6500, lng: 128.6700 } },
                    { name: "Nami Island", type: "attraction", coords: { lat: 37.7913, lng: 127.5261 } },
                    { name: "Seoul Airbnb", type: "home", coords: { lat: 37.5834, lng: 126.9852 } }
                ],
                routes: [
                    { from: 0, to: 1, type: "car" }, 
                    { from: 1, to: 2, type: "car" }
                ],
                stats: { driving: 200, subway: 0, walking: 3 },
                schedule: [
                    { time: "9:00", location: "Ski Resort", activity: "Check-out", transport: "üöó 1.5h" },
                    { time: "11:30", location: "Nami Ferry", activity: "Arrive", transport: "‚õ¥Ô∏è 5min" },
                    { time: "12:00", location: "Island", activity: "Lunch", transport: "üö∂" },
                    { time: "13:00", location: "Nami", activity: "Trees - bikes - photos", transport: "üö∂üö¥" },
                    { time: "14:30", location: "Playground", activity: "Kids & animals", transport: "üö∂" },
                    { time: "15:30", location: "Ferry", activity: "Return", transport: "‚õ¥Ô∏è 5min" },
                    { time: "16:00", location: "Parking", activity: "Depart Seoul", transport: "üöó 1.5h" },
                    { time: "17:30", location: "Seoul Airbnb", activity: "Check-in", transport: "üö∂ 10min" },
                    { time: "18:30", location: "Nearby", activity: "Dinner", transport: "üö∂" },
                    { time: "20:00", location: "Airbnb", activity: "Rest", transport: null }
                ]
            },
            {
                day: 5, date: "Dec 24", title: "Seoul Cultural Day",
                center: { lat: 37.5760, lng: 126.9838 },
                zoom: 13,
                locations: [
                    { name: "Airbnb", type: "home", coords: { lat: 37.5834, lng: 126.9852 } },
                    { name: "Caf√© Onion", type: "food", coords: { lat: 37.5796, lng: 126.9856 } },
                    { name: "Gyeongbokgung", type: "attraction", coords: { lat: 37.5796, lng: 126.9770 } },
                    { name: "Bukchon", type: "attraction", coords: { lat: 37.5824, lng: 126.9852 } },
                    { name: "Insadong", type: "shopping", coords: { lat: 37.5720, lng: 126.9856 } },
                    { name: "Ikseondong", type: "attraction", coords: { lat: 37.5717, lng: 126.9917 } },
                    { name: "Myeongdong", type: "shopping", coords: { lat: 37.5636, lng: 126.9826 } },
                    { name: "Cheonggyecheon", type: "attraction", coords: { lat: 37.5696, lng: 126.9783 } }
                ],
                routes: [
                    { from: 0, to: 1, type: "walk" }, { from: 1, to: 2, type: "walk" },
                    { from: 2, to: 3, type: "walk" }, { from: 3, to: 4, type: "walk" },
                    { from: 4, to: 5, type: "walk" }, { from: 5, to: 6, type: "subway" },
                    { from: 6, to: 7, type: "walk" }
                ],
                stats: { driving: 0, subway: 2, walking: 4 },
                schedule: [
                    { time: "8:00", location: "Caf√© Onion", activity: "Breakfast", transport: "üö∂ 2min" },
                    { time: "9:15", location: "Gyeongbokgung", activity: "Royal Guard", transport: "üö∂ 15min" },
                    { time: "11:00", location: "Bukchon", activity: "Hanok photos", transport: "üö∂ 10min" },
                    { time: "12:30", location: "Insadong", activity: "Lunch + Ssamziegil", transport: null },
                    { time: "13:30", location: "Insadong", activity: "Tea - crafts", transport: "üö∂ 12min" },
                    { time: "14:30", location: "Ikseondong", activity: "Trendy caf√©s", transport: "üöá 12min" },
                    { time: "16:30", location: "Myeongdong", activity: "Shopping - BTS", transport: null },
                    { time: "18:30", location: "Myeongdong", activity: "Halal dinner", transport: "üö∂ 5min" },
                    { time: "19:30", location: "Cheonggyecheon", activity: "Lanterns", transport: "üöá 15min" },
                    { time: "21:00", location: "Airbnb", activity: "Rest", transport: null }
                ]
            },
            {
                day: 6, date: "Dec 25", title: "Christmas Gangnam",
                center: { lat: 37.5400, lng: 127.0000 },
                zoom: 12,
                locations: [
                    { name: "Airbnb", type: "home", coords: { lat: 37.5834, lng: 126.9852 } },
                    { name: "Namdaemun", type: "shopping", coords: { lat: 37.5598, lng: 126.9770 } },
                    { name: "Myeongdong", type: "shopping", coords: { lat: 37.5636, lng: 126.9826 } },
                    { name: "COEX", type: "shopping", coords: { lat: 37.5115, lng: 127.0595 } },
                    { name: "Jamsil", type: "attraction", coords: { lat: 37.5111, lng: 127.0981 } }
                ],
                routes: [
                    { from: 0, to: 1, type: "subway" }, 
                    { from: 1, to: 2, type: "walk" },
                    { from: 2, to: 3, type: "subway" }, 
                    { from: 3, to: 4, type: "subway" }
                ],
                stats: { driving: 0, subway: 95, walking: 2 },
                schedule: [
                    { time: "9:00", location: "Namdaemun", activity: "Traditional market", transport: "üöá 20min" },
                    { time: "11:00", location: "Myeongdong", activity: "Hanbok + Kampungku lunch", transport: "üö∂ 10min" },
                    { time: "12:30", location: "Travel", activity: "To Gangnam", transport: "üöá 35min" },
                    { time: "13:30", location: "COEX", activity: "Starfield Library", transport: null },
                    { time: "15:00", location: "COEX", activity: "Aquarium (optional)", transport: "üöá 5min" },
                    { time: "16:30", location: "Jamsil", activity: "Travel to Jamsil", transport: null },
                    { time: "17:00", location: "Lotte World", activity: "Christmas Market", transport: "üö∂ 5min" },
                    { time: "18:30", location: "Jamsil", activity: "Dinner", transport: "üöá 35min" },
                    { time: "20:00", location: "Airbnb", activity: "Rest", transport: null }
                ]
            },
            {
                day: 7, date: "Dec 26", title: "Mosque + Hongdae",
                center: { lat: 37.5400, lng: 126.9000 },
                zoom: 12,
                locations: [
                    { name: "Airbnb", type: "home", coords: { lat: 37.5834, lng: 126.9852 } },
                    { name: "Hongdae", type: "shopping", coords: { lat: 37.5563, lng: 126.9236 } },
                    { name: "Itaewon", type: "attraction", coords: { lat: 37.5347, lng: 126.9946 } },
                    { name: "Dongdaemun", type: "shopping", coords: { lat: 37.5707, lng: 127.0098 } }
                ],
                routes: [
                    { from: 0, to: 1, type: "subway" }, 
                    { from: 1, to: 2, type: "subway" },
                    { from: 2, to: 3, type: "car" }
                ],
                stats: { driving: 20, subway: 60, walking: 2 },
                schedule: [
                    { time: "9:00", location: "Travel", activity: "To Hongdae", transport: "üöá 30min" },
                    { time: "9:30", location: "Hongdae", activity: "Rolling Dice shop", transport: null },
                    { time: "10:30", location: "Hongdae", activity: "Nike Style custom", transport: null },
                    { time: "11:30", location: "Hongdae", activity: "Street performances", transport: "üöá 20min" },
                    { time: "12:00", location: "Travel", activity: "To Itaewon", transport: null },
                    { time: "12:30", location: "Seoul Mosque", activity: "Friday Prayers", transport: null },
                    { time: "13:30", location: "Itaewon", activity: "Halal lunch", transport: "üöó 20min" },
                    { time: "15:00", location: "Dongdaemun", activity: "Shopping", transport: null },
                    { time: "19:00", location: "Dongdaemun", activity: "Dinner", transport: null },
                    { time: "21:00", location: "Dongdaemun", activity: "Nyunyu Wholesale", transport: "üöá 10min" },
                    { time: "22:30", location: "Airbnb", activity: "Rest", transport: null }
                ]
            },
            {
                day: 8, date: "Dec 27", title: "Free & Easy Shopping",
                center: { lat: 37.5500, lng: 127.0000 },
                zoom: 12,
                locations: [
                    { name: "Airbnb", type: "home", coords: { lat: 37.5834, lng: 126.9852 } },
                    { name: "Myeongdong", type: "shopping", coords: { lat: 37.5636, lng: 126.9826 } },
                    { name: "Dongdaemun", type: "shopping", coords: { lat: 37.5707, lng: 127.0098 } },
                    { name: "COEX", type: "shopping", coords: { lat: 37.5115, lng: 127.0595 } }
                ],
                routes: [
                    { from: 0, to: 1, type: "subway" }, 
                    { from: 1, to: 2, type: "subway" },
                    { from: 2, to: 3, type: "subway" }
                ],
                stats: { driving: 0, subway: 95, walking: 3 },
                schedule: [
                    { time: "9:00", location: "Myeongdong", activity: "Free shopping", transport: "üöá 15min" },
                    { time: "12:00", location: "Myeongdong", activity: "Lunch", transport: "üöá 15min" },
                    { time: "13:00", location: "Dongdaemun", activity: "Wholesale markets", transport: "üöá 30min" },
                    { time: "16:00", location: "COEX", activity: "Final shopping", transport: null },
                    { time: "19:00", location: "Gangnam", activity: "Dinner", transport: "üöá 35min" },
                    { time: "20:30", location: "Airbnb", activity: "Pack", transport: null }
                ]
            },
            {
                day: 9, date: "Dec 28", title: "Departure",
                center: { lat: 37.5000, lng: 126.7000 },
                zoom: 10,
                locations: [
                    { name: "Airbnb", type: "home", coords: { lat: 37.5834, lng: 126.9852 } },
                    { name: "Incheon", type: "airport", coords: { lat: 37.4602, lng: 126.4407 } }
                ],
                routes: [{ from: 0, to: 1, type: "bus" }],
                stats: { driving: 60, subway: 0, walking: 0 },
                schedule: [
                    { time: "6:00", location: "Airbnb", activity: "Wake up", transport: null },
                    { time: "7:00", location: "Airbnb", activity: "Check-out", transport: "üöå 1.5h" },
                    { time: "7:15", location: "Anguk Stn", activity: "Bus 6011", transport: null },
                    { time: "8:45", location: "Airport", activity: "Arrive", transport: "üö∂" },
                    { time: "9:00", location: "Check-in", activity: "Bag drop", transport: "üö∂" },
                    { time: "10:00", location: "Immigration", activity: "Security", transport: "üö∂" },
                    { time: "10:30", location: "Duty Free", activity: "Shopping", transport: "üö∂" },
                    { time: "11:00", location: "Gate", activity: "Flight to KLIA", transport: null }
                ]
            }
        ];

        // Initialize Google Map
        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 10,
                center: { lat: 37.5665, lng: 126.9780 }, // Seoul default
                mapTypeControl: true,
                streetViewControl: true,
                fullscreenControl: true,
                zoomControl: true
            });

            renderButtons();
            renderDay();
        }

        function renderButtons() {
            document.getElementById('dayButtons').innerHTML = scheduleData.map(d => 
                `<button class="day-btn ${d.day === currentDay ? 'active' : ''}" onclick="selectDay(${d.day})">
                    <div class="day-label">Day ${d.day + 1}</div>
                    <div class="day-date">${d.date}</div>
                </button>`
            ).join('');
        }

        function selectDay(n) {
            currentDay = n;
            renderButtons();
            renderDay();
        }

        function renderDay() {
            const d = scheduleData[currentDay];
            
            // Update title and stats
            document.getElementById('dayTitle').textContent = `Day ${d.day + 1}: ${d.title}`;
            document.getElementById('regionText').textContent = d.title;
            document.getElementById('statDriving').textContent = `${d.stats.driving}km`;
            document.getElementById('statSubway').textContent = `${d.stats.subway}min`;
            document.getElementById('statWalking').textContent = `${d.stats.walking}km`;

            // Clear existing markers and polylines
            markers.forEach(m => m.setMap(null));
            markers = [];
            
            polylines.forEach(p => p.setMap(null));
            polylines = [];

            // Update map center and zoom
            map.setCenter(d.center);
            map.setZoom(d.zoom);

            // Add markers for each location
            d.locations.forEach((loc, index) => {
                const marker = new google.maps.Marker({
                    position: loc.coords,
                    map: map,
                    title: loc.name,
                    label: {
                        text: (index + 1).toString(),
                        color: 'white',
                        fontWeight: 'bold',
                        fontSize: '12px'
                    },
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 18,
                        fillColor: typeColors[loc.type],
                        fillOpacity: 1,
                        strokeColor: 'white',
                        strokeWeight: 3
                    }
                });

                // Add info window on click
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="padding: 8px; font-family: sans-serif;">
                            <strong style="font-size: 14px; color: #1f2937;">${loc.name}</strong><br>
                            <span style="color: #6b7280; font-size: 12px; text-transform: capitalize;">${loc.type}</span>
                        </div>
                    `
                });

                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });

                markers.push(marker);
                markersByLocation[loc.name] = marker;
            });

            // Draw simple routes
            if (d.routes && d.routes.length > 0) {
                d.routes.forEach(route => {
                    const start = d.locations[route.from].coords;
                    const end = d.locations[route.to].coords;
                    
                    const routeColors = {
                        car: '#3b82f6',
                        subway: '#22c55e', 
                        walk: '#eab308',
                        bus: '#a855f7'
                    };

                    const path = new google.maps.Polyline({
                        path: [start, end],
                        geodesic: true,
                        strokeColor: routeColors[route.type] || '#6b7280',
                        strokeOpacity: 0.7,
                        strokeWeight: 3,
                        map: map
                    });
                    
                    polylines.push(path); // Store the polyline so we can clear it later
                });
            }

            // Render schedule
            document.getElementById('timeline').innerHTML = d.schedule.map((s, idx) => `
                <div class="timeline-item" onclick="highlightLocation('${s.location}', ${idx})" style="cursor: pointer;">
                    <div class="timeline-time"><div class="time-badge">${s.time}</div></div>
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <div class="timeline-location">${s.location}</div>
                        <div class="timeline-activity">${s.activity}</div>
                        ${s.transport ? `<div class="timeline-transport">${s.transport}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Highlight pin when timeline item is clicked
        function highlightLocation(locationName, scheduleIndex) {
            const d = scheduleData[currentDay];
            const marker = markersByLocation[locationName];
            
            if (marker) {
                // 1. Pan map to this location smoothly
                map.panTo(marker.getPosition());
                
                // 2. Zoom in if needed
                if (map.getZoom() < 15) {
                    map.setZoom(15);
                }
                
                // 3. Make marker bounce
                marker.setAnimation(google.maps.Animation.BOUNCE);
                setTimeout(() => marker.setAnimation(null), 1500); // Stop after 1.5 seconds
                
                // 4. Open info window with activity details
                const activity = d.schedule[scheduleIndex];
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="padding: 10px; font-family: sans-serif; min-width: 200px;">
                            <strong style="font-size: 15px; color: #1f2937;">${locationName}</strong><br>
                            <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #e5e7eb;">
                                <span style="color: #3b82f6; font-size: 12px; font-weight: 600;">${activity.time}</span><br>
                                <span style="color: #4b5563; font-size: 13px;">${activity.activity}</span>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                
                // 5. Highlight timeline item temporarily
                const timelineItems = document.querySelectorAll('.timeline-item');
                timelineItems.forEach(item => item.style.backgroundColor = '');
                timelineItems[scheduleIndex].style.backgroundColor = '#dbeafe';
                timelineItems[scheduleIndex].style.transition = 'background-color 0.3s';
                
                // Remove highlight after 2 seconds
                setTimeout(() => {
                    timelineItems[scheduleIndex].style.backgroundColor = '';
                }, 2000);
            }
        }

        // Make function globally accessible
        window.highlightLocation = highlightLocation;

        // Make selectDay available globally
        window.selectDay = selectDay;
    </script>
</body>
</html>